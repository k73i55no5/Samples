# ここは

https://github.com/k73i55no5/Samples/tree/master/vending180219/0.1.1/src

ここにまとめている、自販機システムのイベントフローを綴っています。

# イベントフロー

## 貨幣を投入する

- 概要
    - 自販機に貨幣を投入する。
- アクター
    - 甲
- 事後条件
    - 甲が所持するログカードに自販機の種類別貨幣格納枚数が記録される。
- トリガー
    - 甲が自販機に貨幣を投入する(insertMoney)。
- 基本フロー
    - 自販機は、受け取った貨幣の種類及び投入金額を確認する(**E-1**)(**E-2**)(**E-3**)。
    - 自販機は、受け取った貨幣を格納し(storeMoney)、投入金額を表示する。
    - 自販機は、甲が所持するログカードに、自販機の種類別貨幣格納枚数を記録する(saveMoneyStored)。
    - ユースケースを終了する。
- 例外フロー
    - **E-1** 投入された貨幣の種類が正しくない(isIncorrect)。
        - エラーメッセージを表示し、ユースケースを終了する。
    - **E-2** 投入金額が1,000円を超える(exceedsCapacity)。
        - エラーメッセージを表示し、ユースケースを終了する。
    - **E-3** 自販機の貨幣格納数のいずれかが最大を超える(exceedsCapacity)。
        - エラーメッセージを表示し、ユースケースを終了する。

細かいですが、文法的に正しくするのと、値を超える前に検出するという意味を込めて、
「isReachThousand」を「exceedsCapacity」に変更しました。

それぞれ同じ英語名をもつ振る舞いが2つ存在しますが、
ゆくゆく、「投入金額」と「金庫」の別々にそれらをもたせるようにします。

## 飲料を購入する

- 概要
    - 自販機より飲料を購入する。
- アクター
    - 甲
- 事後条件
    - 自販機が格納する飲料の本数が減る。
    - 甲の所持金が減る。
    - 甲が所持するログカードに所持金が記録される。
    - 甲が所持するログカードに購入飲料が記録される。
    - 甲が所持するログカードに自販機の種類別飲料格納本数が記録される。
- トリガー
    - 甲が購入する飲料を選択する(selectDrink)。
- 基本フロー
    - 自販機は、選択された飲料の種類及び在庫並びに投入金額を確認する(**E-1**)(**E-2**)(**E-3**)。
    - 自販機は、選択された飲料の在庫を1減じ(decrement)、購入飲料を表示する。
    - 自販機は、甲が所持するログカードに所持金を記録する(saveMoneyInHand)。
    - 自販機は、甲が所持するログカードに購入飲料を記録する(saveDrinkPurchased)。
    - 自販機は、甲が所持するログカードに自販機の飲料格納本数を記録する(saveDrinkStored)。
    - 自販機は、投入金額を更新し、表示する。
    - ユースケースを終了する。
- 例外フロー
    - **E-1** 選択された飲料の種類が正しくない(isIncorrect)。
        - エラーメッセージを表示し、ユースケースを終了する。
    - **E-2** 選択された飲料の在庫がない(isEmpty)。
        - エラーメッセージを表示し、ユースケースを終了する。
    - **E-3** 投入金額が0である(isNotInserted)。
        - エラーメッセージを表示し、ユースケースを終了する。

## コインを返却してもらう

- 概要
    - 自販機よりコインを返却してもらう。
- アクター
    - 甲
- 事後条件
    - 自販機が格納するコインの本数が減る。
    - 自販機の投入金額が0となり、甲に投入金額分のコインがすべて返却される。
    - 甲の所持金が増える。また、甲が所持するヒストリーカードに所持金が記録される。
- トリガー
    - 甲がコイン返却を選択する(selectReturn)。
- 基本フロー
    - 自販機は、投入金額を確認する(**E-1**)。
    - 自販機は、投入金額分のコインをすべて100円硬貨で返却する(returnCoin)(**E-2**)。
    - 自販機は、投入金額を0に更新し、表示する。
    - 自販機は、甲が所持するログカードに所持金を記録する(saveMoneyInHand)。
    - 自販機は、甲が所持するログカードに、自販機の種類別貨幣格納枚数を記録する(saveMoneyStored)。
    - ユースケースを終了する。
- 例外フロー
    - **E-1** 投入金額が0である(isNotInserted)。
        - エラーメッセージを表示し、ユースケースを終了する。
    - **E-2** 自販機の100円貨幣格納数が、コイン返却に必要な枚数を下回る(isNotEnough)。
        - エラーメッセージを表示し、ユースケースを終了する。

## 購入飲料を照会する

- 概要
    - 自販機より購入飲料の履歴を照会する。
- アクター
    - 甲
- トリガー
    - 甲が購入飲料の履歴照会を選択する(selectDisplayLog)。
- 基本フロー
    - 自販機は、甲が購入した飲料の履歴を表示する(displayLog)(**E-1**)。
    - ユースケースを終了する。
- 例外フロー
    - **E-1** 飲料の購入履歴がない。
        - エラーメッセージを表示し、ユースケースを終了する。

## 飲料を補充する

- 概要
    - 自販機に飲料を補充する。
- アクター
    - 業者
- 事後条件
    - 自販機に格納される全種類の飲料の本数が最大になる。
- トリガー
    - 業者が飲料の補充を選択する(selectRefillDrink)。
- 基本フロー
    - 自販機は、格納している全種類の飲料の本数を最大にする(refillDrink)。
    - ユースケースを終了する。

## コインを補充する

- 概要
    - 自販機にコインを補充する。
- アクター
    - 業者
- 事後条件
    - 自販機に格納される100円硬貨の枚数が最大になる。
- トリガー
    - 業者がコインの補充を選択する(selectRefillCoin)。
- 基本フロー
    - 自販機は、格納している100円硬貨の枚数を最大にする(refillCoin)。
    - ユースケースを終了する。
